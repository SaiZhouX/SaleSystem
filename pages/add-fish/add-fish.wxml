<!--pages/add-fish/add-fish.wxml-->
<view class="container">
  <view class="header">
    <button class="batch-add-btn" bindtap="navigateToBatchAddFish" style="width: 160rpx !important; box-sizing: border-box !important; padding: 0 !important;">批量添加</button>
  </view>
  <form bindsubmit="formSubmit">
    <view class="form-item">
      <text class="item-label">进货日期</text>
      <picker mode="date" value="{{purchaseDate}}" bindchange="bindDateChange" name="purchaseDate">
        <view class="picker">{{purchaseDate}}</view>
      </picker>
    </view>
    <view class="form-item">
      <text class="item-label">单价</text>
      <input class="price-input form-input" name="purchasePrice" type="digit" placeholder="请输入单价" />
    </view>
    <view class="photo-section">
      <view class="section-title">鱼类照片</view>
      <view class="photo-container">
        <image wx:if="{{photoPath}}" src="{{photoPath}}" class="fish-photo" mode="aspectFit" bindtap="previewPhoto"></image>
        <view wx:else class="photo-placeholder">
          <text class="placeholder-text">暂无照片</text>
          <button class="photo-btn-center" bindtap="takePhoto">拍照</button>
        </view>
      </view>
    </view>

    <view class="qrcode-section" wx:if="{{fishId}}">
      <view class="section-title">QR码</view>
      <image wx:if="{{qrcodeImageUrl}}" src="{{qrcodeImageUrl}}" class="qrcode-image" mode="aspectFill" bindload="onQRImageLoad" binderror="onQRImageError"></image>
      <canvas wx:if="{{!qrcodeImageUrl && !qrcodeError}}" canvas-id="qrcode" class="qrcode-canvas"></canvas>
      <view class="qrcode-text-display" wx:if="{{qrcodeError}}">{{qrcode}}</view>
    </view>
    <button form-type="submit" class="submit-btn" style="width: 320rpx !important; box-sizing: border-box !important; padding: 0 !important;">确认添加</button>
  </form>
</view>