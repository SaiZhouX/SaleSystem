<!--index.wxml-->
<view class="container">
  <view class="dashboard">
    <view class="summary-card">
      <view class="income" bindtap="goToIncomeDetail" wx:if="{{showRealAmount}}">
        <text class="label">总收入</text>
        <text class="amount">¥{{maskedIncome}}</text>
      </view>
      <view class="income" wx:else>
        <text class="label">总收入</text>
        <text class="amount">¥{{maskedIncome}}</text>
      </view>
      <view class="expense" bindtap="goToExpenseDetail" wx:if="{{showRealAmount}}">
        <text class="label">总支出</text>
        <text class="amount">¥{{maskedExpense}}</text>
      </view>
      <view class="expense" wx:else>
        <text class="label">总支出</text>
        <text class="amount">¥{{maskedExpense}}</text>
      </view>
      <view class="verify-tip" wx:if="{{!showRealAmount}}" bindtap="verifyAndShowAmount">
        <text>查看金额</text>
      </view>
    </view>
  </view>

  <view class="scan-button-container">
    <button class="scan-button" bindtap="scanCode">扫码查询</button>
    <button class="list-button" bindtap="goToFishList">信息列表</button>
    <button class="cleanup-button" bindtap="clearAllData">清理所有</button>
  </view>

  <view class="fish-list-container">
    <view class="list-header">
      <text class="list-title">库存概览</text>
      <view class="status-tabs">
        <view class="tab-item {{currentTab === 'instock' ? 'active' : ''}}" bindtap="switchTab" data-tab="instock">
          <text>未出售</text>
        </view>
        <view class="tab-item {{currentTab === 'sold' ? 'active' : ''}}" bindtap="switchTab" data-tab="sold">
          <text>已出售</text>
        </view>
        <view class="tab-item {{currentTab === 'dead' ? 'active' : ''}}" bindtap="switchTab" data-tab="dead">
          <text>死亡</text>
        </view>
      </view>
    </view>
    
    <scroll-view scroll-y class="fish-list">
      <view wx:for="{{filteredFishList}}" wx:key="id" class="fish-item" bindtap="goToFishDetail" data-id="{{item.id}}">
        <view class="fish-info">
          <text class="fish-id">ID: {{item.id}}</text>
          <text class="fish-date">
            {{currentTab === 'sold' ? '销售日期: ' + (item.soldDate || '未知日期') : 
              (currentTab === 'dead' ? '死亡日期: ' + (item.deadDate || '未知日期') : 
               '进货日期: ' + (item.purchase_date || '未知日期'))}}
          </text>
        </view>
        <view class="fish-status status-{{item.status || 'instock'}}">
          {{item.status === 'sold' ? '已出售' : (item.status === 'dead' ? '死亡' : '未出售')}}
        </view>
      </view>
      <view wx:if="{{filteredFishList.length == 0}}" class="empty-list">
        <text>{{currentTab === 'instock' ? '暂无未出售的鱼' : (currentTab === 'sold' ? '暂无已出售的鱼' : '暂无死亡的鱼')}}</text>
      </view>
    </scroll-view>
  </view>

  <tabbar tabbar="{{tabbar}}"></tabbar>
</view>