<!--pages/fish-detail/fish-detail.wxml-->
<view class="container" wx:if="{{fishInfo}}">
  <view class="photo-section">
    <view class="section-title">鱼类照片</view>
    <view class="photo-container">
      <image wx:if="{{fishInfo.photoPath}}" src="{{fishInfo.photoPath}}" class="fish-photo" mode="aspectFit" bindtap="previewPhoto"></image>
      <view wx:else class="photo-placeholder">
        <text class="placeholder-text">暂无照片</text>
        <button class="photo-btn-center" bindtap="takePhoto">拍照</button>
      </view>
    </view>
  </view>

  <view class="detail-card">
    <view class="detail-item"><text class="label">批次号:</text> <text class="value">{{fishInfo.batch || '未设置'}}</text></view>
    <view class="detail-item"><text class="label">进货日期:</text> <text class="value">{{fishInfo.purchase_date}}</text></view>
    <view class="detail-item"><text class="label">进货价格:</text> <text class="value">¥{{fishInfo.purchasePrice}}</text></view>
    <view class="detail-item">
      <text class="label">状态:</text> 
      <text class="value status-{{fishInfo.status || 'instock'}}">{{fishInfo.status === 'sold' ? '已出售' : (fishInfo.status === 'dead' ? '死亡' : '未出售')}}</text>
    </view>
    
    <!-- 已售出状态显示销售信息 -->
    <view wx:if="{{fishInfo.status === 'sold'}}" class="detail-item">
      <text class="label">销售日期:</text> 
      <text class="value">{{fishInfo.soldDate}}</text>
    </view>
    <view wx:if="{{fishInfo.status === 'sold'}}" class="detail-item">
      <text class="label">销售价格:</text> 
      <text class="value">¥{{fishInfo.soldPrice}}</text>
    </view>
    
    <!-- 死亡状态显示死亡信息 -->
    <view wx:if="{{fishInfo.status === 'dead'}}" class="detail-item">
      <text class="label">死亡日期:</text> 
      <text class="value">{{fishInfo.deadDate}}</text>
    </view>
    <view wx:if="{{fishInfo.status === 'dead'}}" class="detail-item">
      <text class="label">损失金额:</text> 
      <text class="value loss-amount">¥{{fishInfo.purchasePrice}}</text>
    </view>
  </view>

  <view class="qrcode-section" wx:if="{{fishInfo.qrcode || fishInfo.barcode || fishInfo.id}}">
    <view class="section-title">QR码</view>
    <image wx:if="{{qrcodeImageUrl}}" src="{{qrcodeImageUrl}}" class="qrcode-image" mode="aspectFit" bindload="onQRImageLoad" binderror="onQRImageError"></image>
    <view class="qrcode-text" wx:if="{{qrcodeError}}">
      <text class="error-message">QR码未生成</text>
      <text class="qrcode-id">ID: {{fishInfo.qrcode || fishInfo.barcode || fishInfo.id}}</text>
    </view>
  </view>

  <!-- 操作按钮区域 - 只有未出售状态才显示 -->
  <view class="action-section" wx:if="{{fishInfo.status === 'instock' || !fishInfo.status}}">
    <view class="button-row">
      <button class="sell-btn" bindtap="sellFish">标记为已出售</button>
      <button class="dead-btn" bindtap="markAsDead">标记为死亡</button>
    </view>
  </view>

</view>
